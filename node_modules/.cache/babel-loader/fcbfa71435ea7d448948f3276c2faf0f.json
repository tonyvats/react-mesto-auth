{"ast":null,"code":"import _toConsumableArray from\"/Users/vatc/Desktop/praktikum/react-mesto-auth/react-mesto-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"/Users/vatc/Desktop/praktikum/react-mesto-auth/react-mesto-auth/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React from'react';import{Route,Switch,Redirect,useHistory}from'react-router-dom';import'../index.js';import Header from'../components/Header';import Footer from'../components/Footer';import Main from'../components/Main';import AddPlacePopup from'../components/AddPlacePopup';import EditProfilePopup from'./EditProfilePopup';import EditAvatarPopup from'./EditAvatarPopup';import ImagePopup from'../components/ImagePopup';import{CurrentUserContext}from'../contexts/CurrentUserContext';import api from'../utils/api';import ProtectedRoute from'./ProtectedRoute';import Login from'./Login';import Register from'./Register';import InfoTooltip from'./InfoTooltip';import*as auth from'../utils/auth';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";function App(){var history=useHistory();var _React$useState=React.useState(false),_React$useState2=_slicedToArray(_React$useState,2),isEditAvatarPopupOpen=_React$useState2[0],setIsOpenPopupAvatar=_React$useState2[1];var _React$useState3=React.useState(false),_React$useState4=_slicedToArray(_React$useState3,2),isEditProfilePopupOpen=_React$useState4[0],setIsOpenPopupProfile=_React$useState4[1];var _React$useState5=React.useState(false),_React$useState6=_slicedToArray(_React$useState5,2),isAddPlacePopupOpen=_React$useState6[0],setIsOpenPopupPlace=_React$useState6[1];var _React$useState7=React.useState(false),_React$useState8=_slicedToArray(_React$useState7,2),selectedCard=_React$useState8[0],setSelectedCard=_React$useState8[1];var _React$useState9=React.useState(null),_React$useState10=_slicedToArray(_React$useState9,2),imageData=_React$useState10[0],setImageData=_React$useState10[1];var _React$useState11=React.useState([]),_React$useState12=_slicedToArray(_React$useState11,2),cards=_React$useState12[0],setCards=_React$useState12[1];var _React$useState13=React.useState({}),_React$useState14=_slicedToArray(_React$useState13,2),currentUser=_React$useState14[0],setCurrentUser=_React$useState14[1];var _React$useState15=React.useState(false),_React$useState16=_slicedToArray(_React$useState15,2),loggedIn=_React$useState16[0],setLoggedIn=_React$useState16[1];var _React$useState17=React.useState(false),_React$useState18=_slicedToArray(_React$useState17,2),isInfoTooltipOpen=_React$useState18[0],setIsInfoTooltipOpen=_React$useState18[1];var _React$useState19=React.useState(''),_React$useState20=_slicedToArray(_React$useState19,2),email=_React$useState20[0],setEmail=_React$useState20[1];var _React$useState21=React.useState(false),_React$useState22=_slicedToArray(_React$useState21,2),isRequestSuccessful=_React$useState22[0],setisRequestSuccessful=_React$useState22[1];React.useEffect(function(){Promise.all([api.getUserInfoFromServer(),api.getCardsInformation()]).then(function(res){// console.log(res)\nsetCurrentUser(res[0]);setCards(res[1]);}).catch(function(err){return console.error(err);});},[]);function handleEditAvatarClick(){setIsOpenPopupAvatar(true);}function handleAddPlaceClick(){setIsOpenPopupPlace(true);}function handleEditProfileClick(){setIsOpenPopupProfile(true);}function handleCardLike(card){// Снова проверяем, есть ли уже лайк на этой карточке\nvar isLiked=card.likes.some(function(i){return i._id===currentUser._id;});// Отправляем запрос в API и получаем обновлённые данные карточки\napi.changeLikeCardStatus(card._id,!isLiked).then(function(newCard){// Формируем новый массив на основе имеющегося, подставляя в него новую карточку\nvar newCards=cards.map(function(c){return c._id===card._id?newCard:c;});// Обновляем стейт\nsetCards(newCards);}).catch(function(err){return console.error(err);});}function handleCardDelete(card){// Отправляем запрос в API и получаем обновлённые данные карточки\napi.deleteCard(card._id).then(function(){setCards(cards.filter(function(c){return c._id!==card._id;}));}).catch(function(err){return console.error(err);});}function handleUpdateUser(userData){api.setUserInfoOnServer(userData.name,userData.about).then(function(res){setCurrentUser(res);closeAllPopups();closeAllPopups();}).catch(function(err){return console.error(err);});}function handleUpdateAvatar(userData){api.editProfileAvatar(userData.avatar).then(function(res){setCurrentUser(res);closeAllPopups();}).catch(function(err){return console.error(err);});}function handleAddPlaceSubmit(cardData){// console.log(cards);\napi.addCards(cardData.name,cardData.link).then(function(card){setCards([card].concat(_toConsumableArray(cards)));closeAllPopups();}).catch(function(err){return console.error(err);});}function handleCardClick(card){setSelectedCard(true);setImageData(card);}function closeAllPopups(){setIsOpenPopupAvatar(false);setIsOpenPopupProfile(false);setIsOpenPopupPlace(false);setSelectedCard(null);setIsInfoTooltipOpen(false);}function handleRegister(email,password){auth.register(email,password).then(function(res){if(res.data){setisRequestSuccessful(true);setIsInfoTooltipOpen(true);history.push('/sign-in');}}).catch(function(err){console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430: \".concat(err));setisRequestSuccessful(false);setIsInfoTooltipOpen(true);});}var handleLogin=function handleLogin(email,password){auth.authorize(email,password).then(function(res){if(res.token){setLoggedIn(true);localStorage.setItem('jwt',res.token);history.push('/');}}).catch(function(err){console.log(\"\\u041E\\u0448\\u0438\\u0431\\u043A\\u0430: \".concat(err));setIsInfoTooltipOpen(true);setisRequestSuccessful(false);});};function handleLogout(){setLoggedIn(false);setEmail(email);localStorage.removeItem('jwt');history.push('/sign-in');}function handleCheckToken(){var jwt=localStorage.getItem('jwt');if(jwt){auth.getContent(jwt).then(function(res){if(res){setLoggedIn(true);setEmail(res.data.email);history.push('/');}}).catch(function(err){console.log(err);});}}React.useEffect(function(){handleCheckToken();},[loggedIn]);return/*#__PURE__*/_jsxs(\"div\",{className:\"page\",children:[/*#__PURE__*/_jsxs(CurrentUserContext.Provider,{value:currentUser,children:[/*#__PURE__*/_jsx(Header,{email:email,loggedOut:handleLogout,loggedIn:loggedIn}),/*#__PURE__*/_jsxs(Switch,{children:[/*#__PURE__*/_jsx(ProtectedRoute,{exact:true,path:\"/\",loggedIn:loggedIn,component:Main,onEditAvatar:handleEditAvatarClick,onEditProfile:handleEditProfileClick,onAddPlace:handleAddPlaceClick,onCardClick:handleCardClick,onCardList:cards,onCardLike:handleCardLike,onDeleteCard:handleCardDelete}),/*#__PURE__*/_jsx(Route,{path:\"/sign-in\",children:/*#__PURE__*/_jsx(Login,{handleLogin:handleLogin,setEmail:setEmail})}),/*#__PURE__*/_jsx(Route,{path:\"/sign-up\",children:/*#__PURE__*/_jsx(Register,{handleRegister:handleRegister})}),/*#__PURE__*/_jsx(Route,{children:loggedIn?/*#__PURE__*/_jsx(Redirect,{to:\"/\"}):/*#__PURE__*/_jsx(Redirect,{to:\"/sign-in\"})})]}),/*#__PURE__*/_jsx(EditProfilePopup,{isOpen:isEditProfilePopupOpen,onClose:closeAllPopups,onUpdateUser:handleUpdateUser}),/*#__PURE__*/_jsx(EditAvatarPopup,{isOpen:isEditAvatarPopupOpen,onClose:closeAllPopups,onUpdateAvatar:handleUpdateAvatar}),/*#__PURE__*/_jsx(AddPlacePopup,{isOpen:isAddPlacePopupOpen,onClose:closeAllPopups,onAddCard:handleAddPlaceSubmit}),/*#__PURE__*/_jsx(ImagePopup,{card:imageData,isOpen:selectedCard,onClose:closeAllPopups}),/*#__PURE__*/_jsx(InfoTooltip,{isRequestSuccessful:isRequestSuccessful,isOpen:isInfoTooltipOpen,onClose:closeAllPopups})]}),/*#__PURE__*/_jsx(Footer,{})]});}export default App;","map":{"version":3,"sources":["/Users/vatc/Desktop/praktikum/react-mesto-auth/react-mesto-auth/src/components/App.js"],"names":["React","Route","Switch","Redirect","useHistory","Header","Footer","Main","AddPlacePopup","EditProfilePopup","EditAvatarPopup","ImagePopup","CurrentUserContext","api","ProtectedRoute","Login","Register","InfoTooltip","auth","App","history","useState","isEditAvatarPopupOpen","setIsOpenPopupAvatar","isEditProfilePopupOpen","setIsOpenPopupProfile","isAddPlacePopupOpen","setIsOpenPopupPlace","selectedCard","setSelectedCard","imageData","setImageData","cards","setCards","currentUser","setCurrentUser","loggedIn","setLoggedIn","isInfoTooltipOpen","setIsInfoTooltipOpen","email","setEmail","isRequestSuccessful","setisRequestSuccessful","useEffect","Promise","all","getUserInfoFromServer","getCardsInformation","then","res","catch","err","console","error","handleEditAvatarClick","handleAddPlaceClick","handleEditProfileClick","handleCardLike","card","isLiked","likes","some","i","_id","changeLikeCardStatus","newCard","newCards","map","c","handleCardDelete","deleteCard","filter","handleUpdateUser","userData","setUserInfoOnServer","name","about","closeAllPopups","handleUpdateAvatar","editProfileAvatar","avatar","handleAddPlaceSubmit","cardData","addCards","link","handleCardClick","handleRegister","password","register","data","push","log","handleLogin","authorize","token","localStorage","setItem","handleLogout","removeItem","handleCheckToken","jwt","getItem","getContent"],"mappings":"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","sourcesContent":["import React from 'react';\nimport { Route, Switch, Redirect, useHistory } from 'react-router-dom';\nimport '../index.js';\nimport Header from '../components/Header';\nimport Footer from '../components/Footer';\nimport Main from '../components/Main';\nimport AddPlacePopup from '../components/AddPlacePopup';\nimport EditProfilePopup from './EditProfilePopup';\nimport EditAvatarPopup from './EditAvatarPopup';\nimport ImagePopup from '../components/ImagePopup';\nimport { CurrentUserContext } from '../contexts/CurrentUserContext';\nimport api from '../utils/api';\nimport ProtectedRoute from './ProtectedRoute';\nimport Login from './Login';\nimport Register from './Register';\nimport InfoTooltip from './InfoTooltip';\nimport * as auth from '../utils/auth';\n\nfunction App() {\n\n    const history = useHistory();\n\n    const [isEditAvatarPopupOpen, setIsOpenPopupAvatar] = React.useState(false);\n    const [isEditProfilePopupOpen, setIsOpenPopupProfile] = React.useState(false);\n    const [isAddPlacePopupOpen, setIsOpenPopupPlace] = React.useState(false);\n    const [selectedCard, setSelectedCard] = React.useState(false);\n    const [imageData, setImageData] = React.useState(null)\n    \n    const [cards, setCards] = React.useState([])\n    const [currentUser,  setCurrentUser] = React.useState({}); \n\n    const [loggedIn, setLoggedIn] = React.useState(false);\n    const [isInfoTooltipOpen, setIsInfoTooltipOpen] = React.useState(false);\n    const [email, setEmail] = React.useState('');\n    const [isRequestSuccessful, setisRequestSuccessful] = React.useState(false);\n\n    React.useEffect(() => {\n        Promise.all([api.getUserInfoFromServer(), api.getCardsInformation()])\n            .then(res => {\n                // console.log(res)\n                setCurrentUser(res[0]);\n                setCards(res[1]);\n            })\n            .catch((err) => console.error(err));\n      }, []);\n\n    function handleEditAvatarClick() {\n        setIsOpenPopupAvatar(true);\n    }\n    \n    function handleAddPlaceClick() {\n        setIsOpenPopupPlace(true);\n    }\n\n    function handleEditProfileClick() {\n        setIsOpenPopupProfile(true);\n    }\n\n    function handleCardLike(card) {\n        // Снова проверяем, есть ли уже лайк на этой карточке\n        const isLiked = card.likes.some(i => i._id === currentUser._id);\n        \n        // Отправляем запрос в API и получаем обновлённые данные карточки\n        api.changeLikeCardStatus(card._id, !isLiked).then((newCard) => {\n            // Формируем новый массив на основе имеющегося, подставляя в него новую карточку\n          const newCards = cards.map((c) => c._id === card._id ? newCard : c);\n          // Обновляем стейт\n          setCards(newCards);\n        })\n        .catch((err) => console.error(err));\n    } \n\n    function handleCardDelete(card) {\n        // Отправляем запрос в API и получаем обновлённые данные карточки\n        api.deleteCard(card._id)\n            .then(() => {\n                setCards(cards.filter(c => c._id !== card._id));\n        })\n        .catch((err) => console.error(err));\n    }\n    \n    function handleUpdateUser(userData) {\n        api.setUserInfoOnServer(userData.name, userData.about)\n            .then(res => {\n                setCurrentUser(res);\n                closeAllPopups();\n                closeAllPopups()\n        })\n        .catch((err) => console.error(err))\n    }\n\n    function handleUpdateAvatar(userData) {\n        api.editProfileAvatar(userData.avatar)\n            .then(res => {\n                setCurrentUser(res);\n                closeAllPopups()\n        })\n        .catch((err) => console.error(err))\n\n    }\n\n    function handleAddPlaceSubmit(cardData) {\n        // console.log(cards);\n        api.addCards(cardData.name, cardData.link)\n            .then(card => {\n                setCards([card, ...cards]);\n                closeAllPopups()\n        })\n        .catch((err) => console.error(err))\n    }\n\n    function handleCardClick(card) {        \n        setSelectedCard(true);\n        setImageData(card);\n    }\n\n    function closeAllPopups() {\n        setIsOpenPopupAvatar(false);\n        setIsOpenPopupProfile(false);\n        setIsOpenPopupPlace(false);\n        setSelectedCard(null);\n        setIsInfoTooltipOpen(false)\n    }\n\n    function handleRegister(email, password) {\n        auth.register(email, password)\n        .then((res) => {\n            if (res.data) {\n                setisRequestSuccessful(true);\n                setIsInfoTooltipOpen(true);\n                history.push('/sign-in');\n            }\n        })\n        .catch((err) => {\n            console.log(`Ошибка: ${err}`);\n            setisRequestSuccessful(false);\n            setIsInfoTooltipOpen(true);\n        })\n    }\n\n    const handleLogin = (email, password) => {\n        auth.authorize(email, password)\n            .then((res) => {\n                if (res.token) {\n                    setLoggedIn(true);\n                    localStorage.setItem('jwt', res.token);\n                    history.push('/')\n                }\n            })\n            .catch((err) => {\n                console.log(`Ошибка: ${err}`);\n                setIsInfoTooltipOpen(true);\n                setisRequestSuccessful(false);\n            })\n    }\n    \n    function handleLogout() {\n        setLoggedIn(false)\n        setEmail(email)\n        localStorage.removeItem('jwt')\n        history.push('/sign-in')\n    }\n\n    function handleCheckToken() {\n        const jwt = localStorage.getItem('jwt')\n        if (jwt) {\n          auth.getContent(jwt)\n            .then((res) => {\n                if (res) {\n                    setLoggedIn(true)\n                    setEmail(res.data.email)\n                    history.push('/')\n                }\n            })\n            .catch((err) => {\n              console.log(err)\n            })\n        }\n    }\n    \n    React.useEffect(() => {\n        handleCheckToken()\n    }, [loggedIn])\n\n    return (\n        <div className=\"page\">\n            <CurrentUserContext.Provider value={currentUser}>\n                <Header \n                    email={email} \n                    loggedOut={handleLogout} \n                    loggedIn={loggedIn}\n                />\n                    <Switch>\n                        \n                        <ProtectedRoute\n                            exact path='/'\n                            loggedIn={loggedIn}\n                            component={Main}\n                            onEditAvatar={handleEditAvatarClick}\n                            onEditProfile={handleEditProfileClick}\n                            onAddPlace={handleAddPlaceClick}\n                            onCardClick={handleCardClick}\n                            onCardList={cards}\n                            onCardLike={handleCardLike}\n                            onDeleteCard={handleCardDelete}\n                        >\n                        </ProtectedRoute>\n\n                        <Route path='/sign-in'>\n                            <Login handleLogin={handleLogin} setEmail={setEmail} />\n                        </Route>\n\n                        <Route path='/sign-up'>\n                            <Register handleRegister={handleRegister} />\n                        </Route>\n\n                        <Route>\n                            {loggedIn ? <Redirect to='/' /> : <Redirect to='/sign-in' />}\n                        </Route>\n                    </Switch>\n                    \n\n\n                <EditProfilePopup \n                    isOpen={isEditProfilePopupOpen} \n                    onClose={closeAllPopups} \n                    onUpdateUser={handleUpdateUser}\n                /> \n\n                <EditAvatarPopup \n                    isOpen={isEditAvatarPopupOpen} \n                    onClose={closeAllPopups} \n                    onUpdateAvatar={handleUpdateAvatar}\n                /> \n\n                <AddPlacePopup\n                    isOpen={isAddPlacePopupOpen}\n                    onClose={closeAllPopups}\n                    onAddCard={handleAddPlaceSubmit}\n                />\n\n                <ImagePopup\n                    card={imageData}\n                    isOpen={selectedCard}\n                    onClose={closeAllPopups}\n                />\n\n                <InfoTooltip \n                    isRequestSuccessful={isRequestSuccessful} \n                    isOpen={isInfoTooltipOpen} \n                    onClose={closeAllPopups} \n                />\n\n\n            </CurrentUserContext.Provider>\n\n            <Footer />\n        </div>\n    );\n}\n\nexport default App;\n "]},"metadata":{},"sourceType":"module"}